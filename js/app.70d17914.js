(function(e){function t(t){for(var n,o,i=t[0],c=t[1],u=t[2],d=0,f=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);l&&l(t);while(f.length)f.shift()();return s.push.apply(s,u||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,i=1;i<r.length;i++){var c=r[i];0!==a[c]&&(n=!1)}n&&(s.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},a={app:0},s=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/test_task_11_19_2021/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";r("85ec")},"04b1":function(e,t,r){"use strict";r("9c82")},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),a=r("5f5b"),s=(r("f9e3"),r("2dd8"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.isLoggedIn?r("b-navbar",{staticClass:"navBar",attrs:{type:"dark",variant:"info"}},[r("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),r("b-navbar-nav",[r("b-nav-item",{attrs:{href:"#"}},[r("router-link",{attrs:{to:e.pathes.dashboard}},[e._v("Dashboard")])],1),r("b-nav-item",{attrs:{href:"#"}},[r("router-link",{attrs:{to:e.pathes.wallets}},[e._v("Wallets")])],1)],1)],1):e._e(),r("router-view")],1)}),o=[],i=(r("d3b7"),r("8c4f")),c=r("1da1"),u=r("3835"),l=r("ade3"),d=r("5530"),f=(r("96cf"),r("159b"),r("4fad"),r("caad"),r("2f62")),b=(r("e9c4"),function(e){return new WebSocket("wss://streamer.cryptocompare.com/v2?api_key=".concat(e))}),m=function(e,t){var r={action:"SubAdd",subs:t};e.send(JSON.stringify(r))},h=function(e,t){var r={action:"SubRemove",subs:t};e.send(JSON.stringify(r))},p=(r("d81d"),{name:"Bitcoin",symbol:"BTC"}),y={name:"Ethereum",symbol:"ETH"},v={name:"Tether",symbol:"USDT"},g=[p,y,v],S=function(e,t){return Math.random()*(t-e)+e},O=function(){return JSON.parse(localStorage.getItem("auth"))},C=function(e){var t=JSON.stringify(e);localStorage.getItem("auth")!==t&&localStorage.setItem("auth",JSON.stringify(e))},w=function(){return g.map((function(e){var t=e.symbol;return{symbol:t,balance:S(0,1.5)}}))},L=function(){return"sdf389dxbf1sdz51fga65dfg74asdf"},_=function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(t){var r,n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.email,n=t.password,a=O(),a.email===r&&a.password===n){e.next=4;break}throw new Error("Incorrect email or password");case 4:return e.abrupt("return",{email:r,token:L(),wallets:w(),apiKey:"e6d107f2e651150cacd15eac68f74fa7646ce27b037786e5b9727cbd0a6d4694"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=g.reduce((function(e,t){return Object(d["a"])(Object(d["a"])({},e),{},Object(l["a"])({},t.symbol,Object(d["a"])(Object(d["a"])({},t),{},{balance:0,rate:0})))}),{}),j=g.reduce((function(e,t){return Object(d["a"])(Object(d["a"])({},e),{},Object(l["a"])({},t.symbol,{}))}),{});n["default"].use(f["a"]);var k=new f["a"].Store({state:{isAuth:!1,user:null,wallets:E,apiKey:"",streamer:null,OHLC_CANDLES:j},mutations:{setAuth:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.isAuth=t},setUser:function(e,t){e.user=t},setWalletBalance:function(e,t){var r=t.symbol,n=t.balance;e.wallets[r].balance=n},setWalletRate:function(e,t){var r=t.symbol,n=t.rate;e.wallets[r].rate=n},setStreamer:function(e,t){e.streamer=t},setOHLCRecord:function(e,t){var r=t.symbol,n=t.record;e.OHLC_CANDLES[r][n.time]=n},updateOHLCRecord:function(e,t){var r=t.symbol,n=t.time,a=t.updatedValues,s=e.OHLC_CANDLES[r][n];Object.entries(a).forEach((function(e){var t=Object(u["a"])(e,2),r=t[0],n=t[1];s[r]=n}))},setOHLC:function(e,t){var r=t.symbol,n=t.newValue;e.OHLC_CANDLES[r]=n},setApiKey:function(e,t){e.apiKey=t}},actions:{login:function(e,t){return Object(c["a"])(regeneratorRuntime.mark((function r(){var n,a,s,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.commit,a=e.getters,r.next=3,_(t);case 3:return s=r.sent,n("setUser",{email:s.email,token:s.token}),o=s.wallets,o.forEach((function(e){return n("setWalletBalance",e)})),n("setApiKey",s.apiKey),n("setAuth"),n("setStreamer",b(a.apiKey)),r.abrupt("return",!0);case 11:case"end":return r.stop()}}),r)})))()},setWalletRate:function(e,t){var r=e.commit;r("setWalletRate",t)},subscribeChannelsStream:function(e,t){var r=e.commit,n=e.getters,a=n.streamer;a instanceof WebSocket&&![2,3].includes(a.readyState)||(a=b(n.apiKey),r("setStreamer",a)),0===a.readyState?a.addEventListener("open",(function(){return m(a,t)})):m(a,t)},unSubscribeChannelsStream:function(e,t){e.commit;var r=e.getters,n=r.streamer;if(!(n instanceof WebSocket)||[2,3].includes(n.readyState))return!0;0===n.readyState?n.addEventListener("open",(function(){return h(n,t)})):h(n,t)},subscribeMessagesStream:function(e,t){var r=e.getters;r.streamer.addEventListener("message",t)},unSubscribeMessagesStream:function(e,t){var r=e.getters;r.streamer.removeEventListener("message",t)},setOHLCRecord:function(e,t){var r=e.getters,n=e.commit;return n("setOHLCRecord",t),r.OHLC[t.symbol][t.record.time]},updateOHLCRecord:function(e,t){var r=e.getters,n=e.commit;return n("updateOHLCRecord",t),r.OHLC[t.symbol][t.time]},setOHLC:function(e,t){var r=e.commit;r("setOHLC",t)}},getters:{isAuth:function(e){return e.isAuth},wallets:function(e){return e.wallets},apiKey:function(e){return e.apiKey},streamer:function(e){return e.streamer},OHLC:function(e){return e.OHLC_CANDLES}}}),M=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"dashboard"},[r("b-form-select",{staticClass:"mt-3",attrs:{"text-align-center":"",value:e.currentCurrency,options:e.currencyOptions,size:"sm"},on:{input:e.changeCurrentCurrency}}),r("div",{ref:"chart",staticClass:"chart"})],1)},$=[],H=(r("4ec9"),r("3ca3"),r("ddb0"),r("b0c0"),r("4e82"),r("07ac"),r("8192")),R=g.reduce((function(e,t){return e.set(t,["24~CCCAGG~".concat(t.symbol,"~USD~D")]),e}),new Map),D={name:"Dashboard",data:function(){return{currentCurrency:p,currencyOptions:g.map((function(e){return{value:e,text:e.name}})),handleMessage:null,chart:null,candleStickSeries:null}},mounted:function(){var e=this;this.chart=Object(H["a"])(this.$refs.chart,{width:400,height:300,margin:"0 auto"}),this.candleStickSeries=this.chart.addCandlestickSeries(),this.$store.dispatch("setOHLC",{symbol:this.currentCurrency.symbol,newValue:{}}).then((function(){e.setDataToChart(),e.handleMessage=function(t){var r=t.data,n=JSON.parse(r);if("24"===n.TYPE){var a,s={time:n.TS,open:n.OPEN,high:n.HIGH,low:n.LOW,close:n.CLOSE};a=s.time in e.$store.getters.OHLC[e.currentCurrency.symbol]?e.$store.dispatch("updateOHLCRecord",{symbol:n.FROMSYMBOL,time:s.time,updatedValues:s}):e.$store.dispatch("setOHLCRecord",{symbol:n.FROMSYMBOL,record:s}),a.then((function(t){n.FROMSYMBOL===e.currentCurrency.symbol&&e.candleStickSeries.update(t)}))}},e.$store.dispatch("subscribeChannelsStream",R.get(e.currentCurrency)).then((function(){return e.$store.dispatch("subscribeMessagesStream",e.handleMessage)}))}))},methods:{setDataToChart:function(){var e=Object.values(this.$store.getters.OHLC[this.currentCurrency.symbol]).sort((function(e,t){return e.time-t.time}));this.candleStickSeries.setData(e)},changeCurrentCurrency:function(e){var t=this;this.$store.dispatch("unSubscribeChannelsStream",R.get(this.currentCurrency)),this.currentCurrency=e,this.$store.dispatch("setOHLC",{symbol:this.currentCurrency.symbol,newValue:{}}).then((function(){t.setDataToChart(),t.$store.dispatch("subscribeChannelsStream",R.get(t.currentCurrency))}))}},beforeDestroy:function(){this.$store.dispatch("unSubscribeChannelsStream",R.get(this.currentCurrency)),this.$store.dispatch("unSubscribeMessagesStream",this.handleMessage)}},x=D,A=(r("b153"),r("2877")),T=Object(A["a"])(x,M,$,!1,null,"a91f4c78",null),W=T.exports,P=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"wallets"},[r("b-table",{attrs:{hover:"",fields:e.fields,items:e.wallets},scopedSlots:e._u([{key:"cell(balancesymbol)",fn:function(t){return[e._v(" "+e._s(t.item.balance+" "+t.item.symbol)+" ")]}}])})],1)},N=[],B=["2~Coinbase~BTC~USD","2~Coinbase~ETH~USD","2~Coinbase~USDT~USD"],K={name:"Wallets",data:function(){return{fields:[{key:"name",label:"Wallet"},{key:"balancesymbol",label:"Balance"},{key:"rate",label:"Rate, $"}],handleMessage:null}},mounted:function(){var e=this;this.handleMessage=function(t){var r=t.data,n=JSON.parse(r);"2"===n.TYPE&&Object.prototype.hasOwnProperty.call(n,"PRICE")&&e.$store.dispatch("setWalletRate",{symbol:n.FROMSYMBOL,rate:n.PRICE})},this.$store.dispatch("subscribeChannelsStream",B).then((function(){return e.$store.dispatch("subscribeMessagesStream",e.handleMessage)}))},computed:{wallets:function(){return Object.values(this.$store.getters.wallets)}},beforeDestroy:function(){this.$store.dispatch("unSubscribeChannelsStream",B),this.$store.dispatch("unSubscribeMessagesStream",this.handleMessage)}},I=K,J=(r("7c0d"),Object(A["a"])(I,P,N,!1,null,"caef2a4c",null)),U=J.exports,V=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"auth"},[r("b-form",{on:{submit:e.handleSubmit}},[r("b-form-group",{attrs:{id:"input-group-1",label:"Email address:","label-for":"input-1"}},[r("b-form-input",{attrs:{id:"input-1",type:"email",placeholder:"Enter email",required:""},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),r("b-form-group",{attrs:{id:"input-group-2",label:"Password:","label-for":"input-2"}},[r("b-form-input",{attrs:{id:"input-2",type:"password",placeholder:"Enter password",required:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),r("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Login")])],1)],1)},Y=[],z={name:"Auth",data:function(){return{email:"",password:""}},methods:{handleSubmit:function(){var e=this;this.$store.dispatch("login",{email:this.email,password:this.password}).then((function(){return e.$router.push(Z.dashboard)})).catch((function(e){return alert(e.message)}))}}},F=z,G=(r("04b1"),Object(A["a"])(F,V,Y,!1,null,"ca8a2706",null)),q=G.exports;n["default"].use(i["a"]);var Z={dashboard:"/dashboard",wallets:"/wallets",auth:"/login"},Q=[{path:Z.dashboard,name:"Dashboard",component:W},{path:Z.wallets,name:"Wallets",component:U},{path:Z.auth,name:"Auth",component:q,beforeEnter:function(e,t,r){k.getters.isAuth?r(Z.dashboard):r()}},{path:"*",redirect:Z.auth}],X=new i["a"]({routes:Q});X.beforeEach((function(e,t,r){e.matched.some((function(e){return e.path===Z.auth}))||k.getters.isAuth?r():r(Z.auth)}));var ee=X,te={data:function(){return{pathes:Z}},computed:{isLoggedIn:function(){return this.$store.getters.isAuth}}},re=te,ne=(r("034f"),Object(A["a"])(re,s,o,!1,null,null,null)),ae=ne.exports;C({email:"test@gmail.com",password:"zvVzdWvWp1yVdyfbZZx0"}),n["default"].config.productionTip=!1,n["default"].use(a["a"]),new n["default"]({router:ee,store:k,render:function(e){return e(ae)}}).$mount("#app")},"7c0d":function(e,t,r){"use strict";r("ad2c")},"85ec":function(e,t,r){},8763:function(e,t,r){},"9c82":function(e,t,r){},ad2c:function(e,t,r){},b153:function(e,t,r){"use strict";r("8763")}});
//# sourceMappingURL=app.70d17914.js.map