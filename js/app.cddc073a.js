(function(e){function t(t){for(var a,o,i=t[0],u=t[1],c=t[2],d=0,f=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&f.push(n[o][0]),n[o]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(e[a]=u[a]);l&&l(t);while(f.length)f.shift()();return s.push.apply(s,c||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],a=!0,i=1;i<r.length;i++){var u=r[i];0!==n[u]&&(a=!1)}a&&(s.splice(t--,1),e=o(o.s=r[0]))}return e}var a={},n={app:0},s=[];function o(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=a,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(r,a,function(t){return e[t]}.bind(null,a));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/test_task_11_19_2021/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var l=u;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";r("85ec")},"04b1":function(e,t,r){"use strict";r("9c82")},"249f":function(e,t,r){},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var a=r("2b0e"),n=r("5f5b"),s=(r("f9e3"),r("2dd8"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.isLoggedIn?r("b-navbar",{staticClass:"navBar",attrs:{type:"dark",variant:"info"}},[r("b-navbar-toggle",{attrs:{target:"nav-collapse"}}),r("b-navbar-nav",[r("b-nav-item",{attrs:{href:"#"}},[r("router-link",{attrs:{to:e.pathes.dashboard}},[e._v("Dashboard")])],1),r("b-nav-item",{attrs:{href:"#"}},[r("router-link",{attrs:{to:e.pathes.wallets}},[e._v("Wallets")])],1)],1)],1):e._e(),r("router-view")],1)}),o=[],i=(r("d3b7"),r("8c4f")),u=r("1da1"),c=r("ade3"),l=r("5530"),d=(r("96cf"),r("159b"),r("caad"),r("2f62")),f=(r("e9c4"),function(e){return new WebSocket("wss://streamer.cryptocompare.com/v2?api_key=".concat(e))}),h=function(e,t){var r={action:"SubAdd",subs:t};e.send(JSON.stringify(r))},b=function(e,t){var r={action:"SubRemove",subs:t};e.send(JSON.stringify(r))},m=(r("d81d"),{name:"Bitcoin",symbol:"BTC"}),p={name:"Ethereum",symbol:"ETH"},y={name:"Tether",symbol:"USDT"},v=[m,p,y],g=function(e,t){return Math.random()*(t-e)+e},S=function(){return JSON.parse(localStorage.getItem("auth"))},C=function(e){var t=JSON.stringify(e);localStorage.getItem("auth")!==t&&localStorage.setItem("auth",JSON.stringify(e))},O=function(){return v.map((function(e){var t=e.symbol;return{symbol:t,balance:g(0,1.5)}}))},w=function(){return"sdf389dxbf1sdz51fga65dfg74asdf"},L=function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){var r,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.email,a=t.password,n=S(),n.email===r&&n.password===a){e.next=4;break}throw new Error("Incorrect email or password");case 4:return e.abrupt("return",{email:r,token:w(),wallets:O(),apiKey:"e6d107f2e651150cacd15eac68f74fa7646ce27b037786e5b9727cbd0a6d4694"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),_=v.reduce((function(e,t){return Object(l["a"])(Object(l["a"])({},e),{},Object(c["a"])({},t.symbol,Object(l["a"])(Object(l["a"])({},t),{},{balance:0,rate:0})))}),{}),k=v.reduce((function(e,t){return Object(l["a"])(Object(l["a"])({},e),{},Object(c["a"])({},t.symbol,{}))}),{});a["default"].use(d["a"]);var E=new d["a"].Store({state:{isAuth:!1,user:null,wallets:_,apiKey:"",streamer:null,OHLC_CANDLES:k},mutations:{setAuth:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.isAuth=t},setUser:function(e,t){e.user=t},setWalletBalance:function(e,t){var r=t.symbol,a=t.balance;e.wallets[r].balance=a},setWalletRate:function(e,t){var r=t.symbol,a=t.rate;e.wallets[r].rate=a},setStreamer:function(e,t){e.streamer=t},setOHLC:function(e,t){var r=t.symbol,a=t.record;e.OHLC_CANDLES[r][a.time]=a},setOHLCGlobal:function(e,t){var r=t.symbol,a=t.newValue;e.OHLC_CANDLES[r]=a},setApiKey:function(e,t){e.apiKey=t}},actions:{login:function(e,t){return Object(u["a"])(regeneratorRuntime.mark((function r(){var a,n,s,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=e.commit,n=e.getters,r.next=3,L(t);case 3:return s=r.sent,a("setUser",{email:s.email,token:s.token}),o=s.wallets,o.forEach((function(e){return a("setWalletBalance",e)})),a("setApiKey",s.apiKey),a("setAuth"),a("setStreamer",f(n.apiKey)),r.abrupt("return",!0);case 11:case"end":return r.stop()}}),r)})))()},setWalletRate:function(e,t){var r=e.commit;r("setWalletRate",t)},subscribeChannelsStream:function(e,t){var r=e.commit,a=e.getters,n=a.streamer;n instanceof WebSocket&&![2,3].includes(n.readyState)||(n=f(a.apiKey),r("setStreamer",n)),0===n.readyState?n.addEventListener("open",(function(){return h(n,t)})):h(n,t)},unSubscribeChannelsStream:function(e,t){e.commit;var r=e.getters,a=r.streamer;if(!(a instanceof WebSocket)||[2,3].includes(a.readyState))return!0;0===a.readyState?a.addEventListener("open",(function(){return b(a,t)})):b(a,t)},subscribeMessagesStream:function(e,t){var r=e.getters;r.streamer.addEventListener("message",t)},unSubscribeMessagesStream:function(e,t){var r=e.getters;r.streamer.removeEventListener("message",t)},setOHLC:function(e,t){var r=e.commit;r("setOHLC",t)},setOHLCGlobal:function(e,t){var r=e.commit;r("setOHLCGlobal",t)}},getters:{isAuth:function(e){return e.isAuth},wallets:function(e){return e.wallets},apiKey:function(e){return e.apiKey},streamer:function(e){return e.streamer},OHLC:function(e){return e.OHLC_CANDLES}}}),j=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"dashboard"},[r("b-form-select",{staticClass:"mt-3",attrs:{"text-align-center":"",value:e.currentCurrency,options:e.currencyOptions,size:"sm"},on:{input:e.changeCurrentCurrency}}),r("div",{ref:"chart",staticClass:"chart"})],1)},M=[],$=(r("4ec9"),r("3ca3"),r("ddb0"),r("b0c0"),r("4e82"),r("07ac"),r("8192")),x=v.reduce((function(e,t){return e.set(t,["24~CCCAGG~".concat(t.symbol,"~USD~D")]),e}),new Map),D={name:"Dashboard",data:function(){return{currentCurrency:m,currencyOptions:v.map((function(e){return{value:e,text:e.name}})),handleMessage:null,chart:null,candleStickSeries:null}},mounted:function(){var e=this;this.chart=Object($["a"])(this.$refs.chart,{width:400,height:300,margin:"0 auto"}),this.candlestickSeries=this.chart.addCandlestickSeries(),this.$store.dispatch("setOHLCGlobal",{symbol:this.currentCurrency.symbol,newValue:{}}).then((function(){e.setDataToChart(),e.handleMessage=function(t){var r=t.data,a=JSON.parse(r);if("24"===a.TYPE){var n={time:a.TS,open:a.OPEN,high:a.HIGH,low:a.LOW,close:a.CLOSE};e.$store.dispatch("setOHLC",{symbol:a.FROMSYMBOL,record:n}).then((function(){a.FROMSYMBOL===e.currentCurrency.symbol&&e.candlestickSeries.update(n)}))}},e.$store.dispatch("subscribeChannelsStream",x.get(e.currentCurrency)).then((function(){return e.$store.dispatch("subscribeMessagesStream",e.handleMessage)}))}))},methods:{setDataToChart:function(){this.candlestickSeries.setData(this.dataChart)},changeCurrentCurrency:function(e){var t=this;this.$store.dispatch("unSubscribeChannelsStream",x.get(this.currentCurrency)),this.currentCurrency=e,this.$store.dispatch("setOHLCGlobal",{symbol:this.currentCurrency.symbol,newValue:{}}).then((function(){t.setDataToChart(),t.$store.dispatch("subscribeChannelsStream",x.get(t.currentCurrency))}))}},computed:{dataChart:function(){var e=this.$store.getters.OHLC[this.currentCurrency.symbol];return Object.values(e).sort((function(e,t){return e-t}))}},beforeDestroy:function(){this.$store.dispatch("unSubscribeChannelsStream",x.get(this.currentCurrency)),this.$store.dispatch("unSubscribeMessagesStream",this.handleMessage)}},A=D,H=(r("ca2a"),r("2877")),T=Object(H["a"])(A,j,M,!1,null,"6dfdd22c",null),W=T.exports,R=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"wallets"},[r("b-table",{attrs:{hover:"",fields:e.fields,items:e.wallets},scopedSlots:e._u([{key:"cell(balancesymbol)",fn:function(t){return[e._v(" "+e._s(t.item.balance+" "+t.item.symbol)+" ")]}}])})],1)},P=[],N=["2~Coinbase~BTC~USD","2~Coinbase~ETH~USD","2~Coinbase~USDT~USD"],B={name:"Wallets",data:function(){return{fields:[{key:"name",label:"Wallet"},{key:"balancesymbol",label:"Balance"},{key:"rate",label:"Rate, $"}],handleMessage:null}},mounted:function(){var e=this;this.handleMessage=function(t){var r=t.data,a=JSON.parse(r);"2"===a.TYPE&&Object.prototype.hasOwnProperty.call(a,"PRICE")&&e.$store.dispatch("setWalletRate",{symbol:a.FROMSYMBOL,rate:a.PRICE})},this.$store.dispatch("subscribeChannelsStream",N).then((function(){return e.$store.dispatch("subscribeMessagesStream",e.handleMessage)}))},computed:{wallets:function(){return Object.values(this.$store.getters.wallets)}},beforeDestroy:function(){this.$store.dispatch("unSubscribeChannelsStream",N),this.$store.dispatch("unSubscribeMessagesStream",this.handleMessage)}},K=B,I=(r("7c0d"),Object(H["a"])(K,R,P,!1,null,"caef2a4c",null)),J=I.exports,G=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"auth"},[r("b-form",{on:{submit:e.handleSubmit}},[r("b-form-group",{attrs:{id:"input-group-1",label:"Email address:","label-for":"input-1"}},[r("b-form-input",{attrs:{id:"input-1",type:"email",placeholder:"Enter email",required:""},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),r("b-form-group",{attrs:{id:"input-group-2",label:"Password:","label-for":"input-2"}},[r("b-form-input",{attrs:{id:"input-2",type:"password",placeholder:"Enter password",required:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),r("b-button",{attrs:{type:"submit",variant:"primary"}},[e._v("Login")])],1)],1)},U=[],V={name:"Auth",data:function(){return{email:"",password:""}},methods:{handleSubmit:function(){var e=this;this.$store.dispatch("login",{email:this.email,password:this.password}).then((function(){return e.$router.push(q.dashboard)})).catch((function(e){return alert(e.message)}))}}},Y=V,z=(r("04b1"),Object(H["a"])(Y,G,U,!1,null,"ca8a2706",null)),F=z.exports;a["default"].use(i["a"]);var q={dashboard:"/dashboard",wallets:"/wallets",auth:"/login"},Z=[{path:q.dashboard,name:"Dashboard",component:W},{path:q.wallets,name:"Wallets",component:J},{path:q.auth,name:"Auth",component:F,beforeEnter:function(e,t,r){E.getters.isAuth?r(q.dashboard):r()}},{path:"*",redirect:q.auth}],Q=new i["a"]({routes:Z});Q.beforeEach((function(e,t,r){e.matched.some((function(e){return e.path===q.auth}))||E.getters.isAuth?r():r(q.auth)}));var X=Q,ee={data:function(){return{pathes:q}},computed:{isLoggedIn:function(){return this.$store.getters.isAuth}}},te=ee,re=(r("034f"),Object(H["a"])(te,s,o,!1,null,null,null)),ae=re.exports;C({email:"test@gmail.com",password:"zvVzdWvWp1yVdyfbZZx0"}),a["default"].config.productionTip=!1,a["default"].use(n["a"]),new a["default"]({router:X,store:E,render:function(e){return e(ae)}}).$mount("#app")},"7c0d":function(e,t,r){"use strict";r("ad2c")},"85ec":function(e,t,r){},"9c82":function(e,t,r){},ad2c:function(e,t,r){},ca2a:function(e,t,r){"use strict";r("249f")}});
//# sourceMappingURL=app.cddc073a.js.map